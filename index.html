function renderAllZones(zonesData) {
            // Render all zones
            renderZonesByType(zonesData, 'all', 'allZonesGrid');
            
            // Render by type
            renderZonesByType(zonesData, 'utility', 'utilitiesGrid');
            renderZonesByType(zonesData, 'hub', 'hubsGrid');
            renderZonesByType(zonesData, 'interface', 'interfacesGrid');
            renderZonesByType(zonesData, 'generation', 'generationGrid');
            renderZonesByType(zonesData, 'load', 'loadGrid');
        }

        function renderZonesByType(zonesData, type, containerId) {
            const container = document.getElementById(containerId);
            const filteredZones = type === 'all' ? zonesData : 
                Object.fromEntries(Object.entries(zonesData).filter(([_, zone]) => 
                    zone.zone_info ? zone.zone_info.type === type : zone.type === type
                ));

            const zoneCards = Object.entries(filteredZones).map(([zoneName, zone]) => {
                const zoneInfo = zone.zone_info || zone;
                const lmp = zone.current_lmp || zone.currentLMP || 0;
                const congestion = zone.current_congestion || zone.congestion || 0;
                const utilization = zone.utilization_pct || zone.utilization || 0;
                const status = zone.price_status || zone.status || 'normal';
                
                return `
                    <div class="zone-card" onclick="showZoneDetails('${zoneName}')">
                        <div class="zone-header">
                            <div class="zone-name">${zoneName}</div>
                            <div class="zone-type">${zoneInfo.type}</div>
                        </div>
                        <div class="zone-price ${status}">
                            ${lmp.toFixed(2)}/MWh
                            <span style="font-size: 0.6em; margin-left: 8px;">
                                ${Math.random() > 0.5 ? 'ðŸ“ˆ' : 'ðŸ“‰'}
                            </span>
                        </div>
                        <div class="zone-details">
                            <div class="detail-row">
                                <span>State:</span>
                                <span>${zoneInfo.state}</span>
                            </div>
                            <div class="detail-row">
                                <span>Capacity:</span>
                                <span>${zoneInfo.capacity}</span>
                            </div>
                            <div class="detail-row">
                                <span>Congestion:</span>
                                <span>${congestion.toFixed(2)}</span>
                            </div>
                            <div class="detail-row">
                                <span>Utilization:</span>
                                <span>${utilization.toFixed(1)}%</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = zoneCards;
        }

        async function loadHistoricalAnalytics() {
            try {
                const response = await fetch('/api/pjm/history/hourly-averages');
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateHistoricalCharts(data);
                } else {
                    throw new Error('Failed to load historical analytics');
                }
            } catch (error) {
                console.error('Error loading historical analytics:', error);
                // Charts will use demo data
            }
        }

        async function loadPredictions() {
            try {
                const response = await fetch('/api/pjm/predictions/all-zones-summary');
                const data = await response.json();
                
                if (data.status === 'success') {
                    updatePredictionsChart(data);
                } else {
                    throw new Error('Failed to load predictions');
                }
            } catch (error) {
                console.error('Error loading predictions:', error);
                // Chart will use demo data
            }
        }

        function updateHistoricalCharts(data) {
            if (data.hourly_system_averages && charts.hourly) {
                const hours = Object.keys(data.hourly_system_averages).sort();
                const avgPrices = hours.map(hour => {
                    const hourData = data.hourly_system_averages[hour];
                    return hourData.system_avg || 0;
                });

                charts.hourly.data.labels = hours.map(h => h.replace('hour_', '') + ':00');
                charts.hourly.data.datasets[0].data = avgPrices;
                charts.hourly.update();
            }
        }

        function updatePredictionsChart(data) {
            if (data.predictions_summary && charts.predictions) {
                const zones = Object.keys(data.predictions_summary);
                const currentPrices = zones.map(zone => {
                    const pred = data.predictions_summary[zone];
                    return pred.current_prediction ? pred.current_prediction.predicted_lmp : 0;
                });

                // Update one dataset with real data
                charts.predictions.data.labels = zones;
                charts.predictions.data.datasets[0].data = currentPrices;
                charts.predictions.update();
            }
        }

        async function showZoneDetails(zoneName) {
            try {
                // Try to get real zone predictions
                const predictionResponse = await fetch(`/api/pjm/predictions/zone/${zoneName}?hours_ahead=24`);
                let predictions = [];
                
                if (predictionResponse.ok) {
                    const predictionData = await predictionResponse.json();
                    if (predictionData.status === 'success') {
                        predictions = predictionData.predictions;
                    }
                }

                // Fallback to demo predictions if API fails
                if (predictions.length === 0) {
                    predictions = Array.from({length: 24}, (_, i) => {
                        const basePrice = Math.random() * 100 + 40;
                        const timestamp = new Date();
                        timestamp.setHours(timestamp.getHours() + i);
                        
                        return {
                            timestamp: timestamp.toISOString(),
                            predicted_lmp: basePrice + (Math.random() - 0.5) * 20,
                            confidence_interval: {
                                upper: basePrice + 15 + Math.random() * 10,
                                lower: basePrice - 15 - Math.random() * 10
                            }
                        };
                    });
                }

                // Get zone info
                const zoneInfo = pjmZones[zoneName] || { 
                    type: 'utility', 
                    state: 'Unknown', 
                    capacity: '1000MW',
                    full_name: zoneName 
                };

                // Generate demo zone analytics
                const zoneAnalytics = generateZoneAnalytics(zoneName);
                
                const modalContent = `
                    <h2>ðŸ“Š ${zoneName} - Comprehensive Analytics</h2>
                    <p style="color: #8892b0; margin-bottom: 30px;">${zoneInfo.full_name} | ${zoneInfo.state}</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="metric-card">
                            <div class="metric-label">Current LMP</div>
                            <div class="metric-value">${zoneAnalytics.currentLMP.toFixed(2)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">365-Day Average</div>
                            <div class="metric-value">${zoneAnalytics.yearAverage.toFixed(2)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Peak Price (365d)</div>
                            <div class="metric-value">${zoneAnalytics.yearPeak.toFixed(2)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Volatility</div>
                            <div class="metric-value">${zoneAnalytics.volatility.toFixed(1)}%</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">24-Hour Prediction</h3>
                        <canvas id="zoneDetailChart" width="400" height="200"></canvas>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">Historical Performance (365 Days)</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="text-align: center; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                                <div style="color: #8892b0; margin-bottom: 5px;">Avg Price</div>
                                <div style="font-size: 1.3em; color: #00d4ff;">${zoneAnalytics.yearAverage.toFixed(2)}</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                                <div style="color: #8892b0; margin-bottom: 5px;">Peak Price</div>
                                <div style="font-size: 1.3em; color: #ff4757;">${zoneAnalytics.yearPeak.toFixed(2)}</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                                <div style="color: #8892b0; margin-bottom: 5px;">Low Price</div>
                                <div style="font-size: 1.3em; color: #00ff88;">${zoneAnalytics.yearLow.toFixed(2)}</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                                <div style="color: #8892b0; margin-bottom: 5px;">Price Spikes</div>
                                <div style="font-size: 1.3em; color: #ff9f43;">${zoneAnalytics.spikes}</div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">Risk Metrics</h3>
                        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div><strong>VaR (95%):</strong> ${zoneAnalytics.var95.toFixed(2)}</div>
                                <div><strong>CVaR:</strong> ${zoneAnalytics.cvar.toFixed(2)}</div>
                                <div><strong>Max Drawdown:</strong> ${zoneAnalytics.maxDrawdown.toFixed(1)}%</div>
                                <div><strong>Correlation with System:</strong> ${zoneAnalytics.correlation.toFixed(3)}</div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('modalContent').innerHTML = modalContent;
                document.getElementById('zoneModal').style.display = 'block';

                // Create zone-specific chart
                setTimeout(() => {
                    createZoneDetailChart(predictions);
                }, 100);

            } catch (error) {
                console.error('Failed to load zone details:', error);
                showError('Failed to load zone details');
            }
        }

        function generateZoneAnalytics(zoneName) {
            const basePrice = 45;
            const volatility = Math.random() * 0.3 + 0.1;
            
            return {
                currentLMP: basePrice * (0.8 + Math.random() * 0.6),
                dayAheadLMP: basePrice * (0.85 + Math.random() * 0.4),
                yearAverage: basePrice * (0.9 + Math.random() * 0.3),
                yearPeak: basePrice * (2.5 + Math.random() * 1.5),
                yearLow: basePrice * (0.3 + Math.random() * 0.2),
                congestion: Math.random() * 25 - 2,
                volatility: volatility * 100,
                utilization: Math.random() * 30 + 65,
                status: Math.random() > 0.7 ? 'high' : Math.random() > 0.3 ? 'normal' : 'low',
                trend: Math.random() > 0.5 ? 'up' : 'down',
                spikes: Math.floor(Math.random() * 15 + 5),
                var95: basePrice * (1.2 + Math.random() * 0.8),
                cvar: basePrice * (1.5 + Math.random() * 1.0),
                maxDrawdown: Math.random() * 25 + 10,
                correlation: 0.6 + Math.random() * 0.35
            };
        }

        function createZoneDetailChart(predictions) {
            const ctx = document.getElementById('zoneDetailChart').getContext('2d');
            
            const hours = predictions.map(p => {
                const date = new Date(p.timestamp);
                return date.getHours() + ':00';
            });

            const priceData = predictions.map(p => p.predicted_lmp);
            const upperBound = predictions.map(p => p.confidence_interval.upper);
            const lowerBound = predictions.map(p => p.confidence_interval.lower);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [
                        {
                            label: 'Predicted LMP',
                            data: priceData,
                            borderColor: '#00d4ff',
                            backgroundColor: 'rgba(0, 212, 255, 0.1)',
                            borderWidth: 3,
                            pointRadius: 4,
                            tension: 0.4
                        },
                        {
                            label: 'Upper Bound',
                            data: upperBound,
                            borderColor: '#ff4757',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            pointRadius: 0,
                            borderDash: [5, 5],
                            tension: 0.4
                        },
                        {
                            label: 'Lower Bound',
                            data: lowerBound,
                            borderColor: '#00ff88',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            pointRadius: 0,
                            borderDash: [5, 5],
                            tension: 0.4
                        }
                    ]
                },
                options: getChartOptions('Predicted LMP ($/MWh)')
            });
        }

        function closeModal() {
            document.getElementById('zoneModal').style.display = 'none';
        }

        function startRealTimeUpdates() {
            updateInterval = setInterval(async () => {
                try {
                    await Promise.all([
                        loadSystemMetrics(),
                        loadNotifications(),
                        updateChartsData()
                    ]);
                    console.log('Real-time update completed');
                } catch (error) {
                    console.error('Real-time update failed:', error);
                }
            }, 30000); // Update every 30 seconds
        }

        async function updateChartsData() {
            // Update real-time chart with new data
            if (charts.realTime) {
                const newRTData = generateHourlyData(24, 45, 0.3);
                const newDAData = generateHourlyData(24, 45, 0.2);
                
                charts.realTime.data.datasets[0].data = newRTData;
                charts.realTime.data.datasets[1].data = newDAData;
                charts.realTime.update('none');
            }

            // Update load generation chart
            if (charts.loadGeneration) {
                const newLoadData = generateHourlyData(24, 85, 0.2);
                const newGenData = newLoadData.map(load => load + Math.random() * 10 + 5);
                
                charts.loadGeneration.data.datasets[0].data = newLoadData;
                charts.loadGeneration.data.datasets[1].data = newGenData;
                charts.loadGeneration.update('none');
            }
        }

        // Event handlers
        function toggleNotifications() {
            notificationsVisible = !notificationsVisible;
            const panel = document.getElementById('notificationsPanel');
            panel.classList.toggle('show', notificationsVisible);
        }

        function switchZoneTab(tabName, element) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            element.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function switchAnalyticsTab(tabName, element) {
            document.querySelectorAll('.tabs .tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.historical-analytics .tab-content').forEach(content => content.classList.remove('active'));
            
            element.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function updateTimeRange(range, buttonElement) {
            document.querySelectorAll('.chart-controls .btn').forEach(btn => btn.classList.remove('active'));
            buttonElement.classList.add('active');
            
            // Update real-time chart based on range
            updateRealTimeChart(range);
        }

        function updatePredictionRange(range, buttonElement) {
            document.querySelectorAll('.prediction-container .btn').forEach(btn => btn.classList.remove('active'));
            buttonElement.classList.add('active');
            
            // Update predictions chart based on range
            updatePredictionsChartRange(range);
        }

        function updateRealTimeChart(range) {
            const hoursBack = range === '1h' ? 1 : range === '6h' ? 6 : range === '24h' ? 24 : 168;
            
            const hours = Array.from({length: hoursBack}, (_, i) => {
                const date = new Date();
                date.setHours(date.getHours() - hoursBack + 1 + i);
                return range === '7d' ? date.toLocaleDateString() : date.getHours() + ':00';
            });

            const rtData = generateHourlyData(hoursBack, 45, 0.3);
            const daData = generateHourlyData(hoursBack, 45, 0.2);

            charts.realTime.data.labels = hours;
            charts.realTime.data.datasets[0].data = rtData;
            charts.realTime.data.datasets[1].data = daData;
            charts.realTime.update();
        }

        function updatePredictionsChartRange(range) {
            const hoursAhead = range === '6h' ? 6 : range === '12h' ? 12 : range === '24h' ? 24 : 48;
            
            const hours = Array.from({length: hoursAhead}, (_, i) => {
                const date = new Date();
                date.setHours(date.getHours() + i);
                return date.getHours() + ':00';
            });

            charts.predictions.data.labels = hours;
            charts.predictions.data.datasets.forEach(dataset => {
                dataset.data = generateHourlyData(hoursAhead, 45 + Math.random() * 20, 0.25);
            });
            charts.predictions.update();
        }

        // Utility functions
        function generateHourlyData(hours, baseValue, volatility) {
            return Array.from({length: hours}, () => 
                baseValue * (1 + (Math.random() - 0.5) * volatility * 2)
            );
        }

        function getChartOptions(yAxisLabel) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: {
                        labels: { color: '#e0e6ed' }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(26, 35, 50, 0.9)',
                        titleColor: '#00d4ff',
                        bodyColor: '#e0e6ed',
                        borderColor: '#00d4ff',
                        borderWidth: 1
                    }
                },
                scales: {
                    x: {
                        ticks: { 
                            color: '#8892b0',
                            maxTicksLimit: 12
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        ticks: { color: '#8892b0' },
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        title: {
                            display: true,
                            text: yAxisLabel,
                            color: '#00d4ff'
                        }
                    }
                }
            };
        }

        function calculateChange(current, previous) {
            const change = ((current - previous) / previous) * 100;
            return {
                value: `${Math.abs(change).toFixed(1)}%`,
                type: change >= 0 ? 'positive' : 'negative'
            };
        }

        function getRandomChange() {
            const isPositive = Math.random() > 0.5;
            const value = (Math.random() * 10).toFixed(1);
            return {
                value: `${value}%`,
                type: isPositive ? 'positive' : 'negative'
            };
        }

        function getStatusColor(status) {
            switch (status.toLowerCase()) {
                case 'high': return '#ff4757';
                case 'normal': return '#00ff88';
                case 'low': return '#ffb142';
                default: return '#8892b0';
            }
        }

        function showError(message) {
            console.error(message);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('zoneModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Close notifications when clicking outside
        document.addEventListener('click', function(event) {
            const panel = document.getElementById('notificationsPanel');
            const trigger = event.target.closest('.alert-counter');
            
            if (!panel.contains(event.target) && !trigger && notificationsVisible) {
                toggleNotifications();
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>30px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">Zone Information</h3>
                        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div><strong>Type:</strong> ${zoneInfo.type.charAt(0).toUpperCase() + zoneInfo.type.slice(1)}</div>
                                <div><strong>State:</strong> ${zoneInfo.state}</div>
                                <div><strong>Capacity:</strong> ${zoneInfo.capacity}</div>
                                <div><strong>Status:</strong> <span style="color: ${getStatusColor(zoneAnalytics.status)}">${zoneAnalytics.status.toUpperCase()}</span></div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom:             'COMED': { type: 'utility', state: 'IL', capacity: '23000MW', full_name: 'Commonwealth Edison' },
            'DAYTON': { type: 'utility', state: 'OH', capacity: '2200MW', full_name: 'Dayton Power & Light' },
            'DEOK': { type: 'utility', state: 'OH', capacity: '1800MW', full_name: 'Duke Energy Ohio/Kentucky' },
            'DOM': { type: 'utility', state: 'VA/NC', capacity: '19000MW', full_name: 'Dominion Virginia Power' },
            'DPL': { type: 'utility', state: 'DE', capacity: '2100MW', full_name: 'Delmarva Power & Light' },
            'DUQ': { type: 'utility', state: 'PA', capacity: '5500MW', full_name: 'Duquesne Light Company' },
            'EKPC': { type: 'utility', state: 'KY', capacity: '3200MW', full_name: 'East Kentucky Power Cooperative' },
            'JCPL': { type: 'utility', state: 'NJ', capacity: '6800MW', full_name: 'Jersey Central Power & Light' },
            'METED': { type: 'utility', state: 'PA', capacity: '4500MW', full_name: 'Metropolitan Edison' },
            'PECO': { type: 'utility', state: 'PA', capacity: '8200MW', full_name: 'PECO Energy Company' },
            'PENELEC': { type: 'utility', state: 'PA', capacity: '3400MW', full_name: 'Pennsylvania Electric Company' },
            'PEPCO': { type: 'utility', state: 'MD/DC', capacity: '6500MW', full_name: 'Potomac Electric Power Company' },
            'PPL': { type: 'utility', state: 'PA', capacity: '8800MW', full_name: 'PPL Electric Utilities' },
            'PSEG': { type: 'utility', state: 'NJ', capacity: '12500MW', full_name: 'Public Service Electric & Gas' },
            'RECO': { type: 'utility', state: 'NJ', capacity: '800MW', full_name: 'Rockland Electric Company' },
            
            // Trading Hubs
            'WESTERN_HUB': { type: 'hub', state: 'Multi', capacity: '45000MW', full_name: 'Western Trading Hub' },
            'EASTERN_HUB': { type: 'hub', state: 'Multi', capacity: '38000MW', full_name: 'Eastern Trading Hub' },
            'NORTHERN_HUB': { type: 'hub', state: 'Multi', capacity: '42000MW', full_name: 'Northern Trading Hub' },
            'SOUTHERN_HUB': { type: 'hub', state: 'Multi', capacity: '35000MW', full_name: 'Southern Trading Hub' },
            'CENTRAL_HUB': { type: 'hub', state: 'Multi', capacity: '40000MW', full_name: 'Central Trading Hub' },
            
            // Interface Points
            'OHIO_INTERFACE': { type: 'interface', state: 'OH', capacity: '8500MW', full_name: 'Ohio Interface Point' },
            'PENN_INTERFACE': { type: 'interface', state: 'PA', capacity: '9200MW', full_name: 'Pennsylvania Interface Point' },
            'VA_INTERFACE': { type: 'interface', state: 'VA', capacity: '7800MW', full_name: 'Virginia Interface Point' },
            'MD_INTERFACE': { type: 'interface', state: 'MD', capacity: '6200MW', full_name: 'Maryland Interface Point' },
            'WV_INTERFACE': { type: 'interface', state: 'WV', capacity: '5500MW', full_name: 'West Virginia Interface Point' },
            'NJ_INTERFACE': { type: 'interface', state: 'NJ', capacity: '8800MW', full_name: 'New Jersey Interface Point' },
            'DE_INTERFACE': { type: 'interface', state: 'DE', capacity: '2100MW', full_name: 'Delaware Interface Point' },
            'IL_INTERFACE': { type: 'interface', state: 'IL', capacity: '12000MW', full_name: 'Illinois Interface Point' },
            'IN_INTERFACE': { type: 'interface', state: 'IN', capacity: '4500MW', full_name: 'Indiana Interface Point' },
            'KY_INTERFACE': { type: 'interface', state: 'KY', capacity: '3800MW', full_name: 'Kentucky Interface Point' },
            'NC_INTERFACE': { type: 'interface', state: 'NC', capacity: '6500MW', full_name: 'North Carolina Interface Point' },
            'TN_INTERFACE': { type: 'interface', state: 'TN', capacity: '3200MW', full_name: 'Tennessee Interface Point' },
            
            // Generation Nodes
            'COAL_CENTRAL': { type: 'generation', state: 'Multi', capacity: '25000MW', full_name: 'Central Coal Generation' },
            'GAS_WEST': { type: 'generation', state: 'Multi', capacity: '35000MW', full_name: 'Western Gas Generation' },
            'NUCLEAR_EAST': { type: 'generation', state: 'Multi', capacity: '28000MW', full_name: 'Eastern Nuclear Generation' },
            'WIND_MIDWEST': { type: 'generation', state: 'Multi', capacity: '15000MW', full_name: 'Midwest Wind Generation' },
            'SOLAR_SOUTH': { type: 'generation', state: 'Multi', capacity: '8500MW', full_name: 'Southern Solar Generation' },
            'HYDRO_NORTH': { type: 'generation', state: 'Multi', capacity: '4200MW', full_name: 'Northern Hydro Generation' },
            
            // Load Zones
            'CHICAGO_LOAD': { type: 'load', state: 'IL', capacity: '18000MW', full_name: 'Chicago Load Zone' },
            'PHILADELPHIA_LOAD': { type: 'load', state: 'PA', capacity: '12000MW', full_name: 'Philadelphia Load Zone' },
            'BALTIMORE_LOAD': { type: 'load', state: 'MD', capacity: '8500MW', full_name: 'Baltimore Load Zone' },
            'CLEVELAND_LOAD': { type: 'load', state: 'OH', capacity: '6800MW', full_name: 'Cleveland Load Zone' },
            'PITTSBURGH_LOAD': { type: 'load', state: 'PA', capacity: '5500MW', full_name: 'Pittsburgh Load Zone' },
            'RICHMOND_LOAD': { type: 'load', state: 'VA', capacity: '4200MW', full_name: 'Richmond Load Zone' },
            'COLUMBUS_LOAD': { type: 'load', state: 'OH', capacity: '3800MW', full_name: 'Columbus Load Zone' },
            'NORFOLK_LOAD': { type: 'load', state: 'VA', capacity: '3200MW', full_name: 'Norfolk Load Zone' }
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            startRealTimeUpdates();
        });

        async function initializeDashboard() {
            console.log('Initializing Advanced PJM Dashboard...');
            try {
                await Promise.all([
                    loadSystemMetrics(),
                    loadNotifications(),
                    loadAllZones(),
                    initializeCharts(),
                    loadHistoricalAnalytics(),
                    loadPredictions()
                ]);
                console.log('Dashboard initialized successfully');
            } catch (error) {
                console.error('Dashboard initialization failed:', error);
                showError('Failed to initialize dashboard');
            }
        }

        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('en-US', { 
                    timeZone: 'America/New_York',
                    hour12: false 
                });
        }

        async function loadSystemMetrics() {
            // Generate realistic system-wide metrics
            const systemData = generateSystemMetrics();
            renderMetrics(systemData);
        }

        function generateSystemMetrics() {
            const basePrice = 45;
            const currentHour = new Date().getHours();
            
            // Peak hour adjustments
            const peakMultiplier = (currentHour >= 6 && currentHour <= 22) ? 1.3 : 0.8;
            
            return {
                currentRTLMP: basePrice * peakMultiplier * (0.9 + Math.random() * 0.4),
                dayAheadLMP: basePrice * peakMultiplier * (0.95 + Math.random() * 0.2),
                peakPrice: basePrice * 2.1 * (0.9 + Math.random() * 0.3),
                systemLoad: 85 + Math.random() * 45,
                totalGeneration: 92 + Math.random() * 35,
                reserveMargin: 12 + Math.random() * 8,
                congestionCost: Math.random() * 25,
                lossesPercent: 2.5 + Math.random() * 1.5,
                activeAlerts: Math.floor(Math.random() * 12),
                volatilityIndex: 15 + Math.random() * 25
            };
        }

        function renderMetrics(data) {
            const metrics = [
                {
                    label: 'Real-Time LMP',
                    value: `${data.currentRTLMP.toFixed(2)}`,
                    change: calculateChange(data.currentRTLMP, data.dayAheadLMP),
                    unit: '/MWh'
                },
                {
                    label: 'Day-Ahead Average',
                    value: `${data.dayAheadLMP.toFixed(2)}`,
                    change: getRandomChange(),
                    unit: '/MWh'
                },
                {
                    label: 'Peak Hour Price',
                    value: `${data.peakPrice.toFixed(2)}`,
                    change: getRandomChange(),
                    unit: '/MWh'
                },
                {
                    label: 'System Load',
                    value: `${data.systemLoad.toFixed(1)}`,
                    change: getRandomChange(),
                    unit: ' GW'
                },
                {
                    label: 'Total Generation',
                    value: `${data.totalGeneration.toFixed(1)}`,
                    change: getRandomChange(),
                    unit: ' GW'
                },
                {
                    label: 'Reserve Margin',
                    value: `${data.reserveMargin.toFixed(1)}`,
                    change: getRandomChange(),
                    unit: '%'
                },
                {
                    label: 'Congestion Cost',
                    value: `${data.congestionCost.toFixed(2)}`,
                    change: getRandomChange(),
                    unit: '/MWh'
                },
                {
                    label: 'System Losses',
                    value: `${data.lossesPercent.toFixed(2)}`,
                    change: getRandomChange(),
                    unit: '%'
                },
                {
                    label: 'Active Alerts',
                    value: data.activeAlerts,
                    change: { value: data.activeAlerts > 5 ? '+High' : 'Normal', type: data.activeAlerts > 5 ? 'negative' : 'positive' },
                    unit: '',
                    alert: data.activeAlerts > 8
                },
                {
                    label: 'Volatility Index',
                    value: `${data.volatilityIndex.toFixed(1)}`,
                    change: getRandomChange(),
                    unit: ''
                }
            ];

            const container = document.getElementById('metricsGrid');
            container.innerHTML = metrics.map(metric => `
                <div class="metric-card ${metric.alert ? 'alert' : ''}">
                    <div class="metric-label">${metric.label}</div>
                    <div class="metric-value">${metric.value}<span style="font-size: 0.6em; color: #8892b0;">${metric.unit}</span></div>
                    <div class="metric-change ${metric.change.type}">
                        ${metric.change.type === 'positive' ? 'â†—' : 'â†˜'} ${metric.change.value}
                    </div>
                </div>
            `).join('');

            // Update alert counter
            document.getElementById('alertCount').textContent = data.activeAlerts;
        }

        async function loadNotifications() {
            const notifications = generateNotifications();
            renderNotifications(notifications);
        }

        function generateNotifications() {
            const notifications = [];
            const zones = Object.keys(pjmZones);
            const alertTypes = ['critical', 'warning', 'info'];
            const messages = [
                'Price spike detected - $150+ /MWh',
                'High congestion on transmission lines',
                'Demand forecast exceeded',
                'Generation unit outage reported',
                'Weather alert affecting operations',
                'Market volatility increased',
                'Emergency reserves activated',
                'Load shedding procedures initiated',
                'Transmission maintenance scheduled',
                'Renewable output below forecast'
            ];

            for (let i = 0; i < 8; i++) {
                const zone = zones[Math.floor(Math.random() * zones.length)];
                const alertType = alertTypes[Math.floor(Math.random() * alertTypes.length)];
                const message = messages[Math.floor(Math.random() * messages.length)];
                
                notifications.push({
                    id: i,
                    zone: zone,
                    type: alertType,
                    message: message,
                    timestamp: new Date(Date.now() - Math.random() * 3600000).toISOString(),
                    price: (45 + Math.random() * 100).toFixed(2)
                });
            }

            return notifications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }

        function renderNotifications(notifications) {
            const container = document.getElementById('notificationsBody');
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #00ff88;">
                        <div style="font-size: 2em; margin-bottom: 10px;">âœ…</div>
                        <div>All systems operational</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = notifications.map(notification => `
                <div class="notification-item ${notification.type}" onclick="showZoneDetails('${notification.zone}')">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                        <strong>${notification.zone}</strong>
                        <span style="font-size: 0.8em; color: #8892b0;">
                            ${new Date(notification.timestamp).toLocaleTimeString()}
                        </span>
                    </div>
                    <div style="margin-bottom: 5px;">${notification.message}</div>
                    <div style="font-size: 0.85em; color: #8892b0;">
                        Current LMP: ${notification.price}/MWh
                    </div>
                </div>
            `).join('');
        }

        async function loadAllZones() {
            const zonesData = generateZonesData();
            renderAllZones(zonesData);
        }

        function generateZonesData() {
            const zonesData = {};
            
            Object.entries(pjmZones).forEach(([zoneName, zoneInfo]) => {
                const basePrice = 45;
                const volatility = Math.random() * 0.3 + 0.1;
                const currentPrice = basePrice * (0.7 + Math.random() * 0.8) * (1 + (Math.random() - 0.5) * volatility);
                
                zonesData[zoneName] = {
                    ...zoneInfo,
                    currentLMP: currentPrice,
                    dayAheadLMP: currentPrice * (0.95 + Math.random() * 0.1),
                    congestion: Math.random() * 20 - 2,
                    losses: Math.random() * 4 + 0.5,
                    load: Math.random() * parseFloat(zoneInfo.capacity.replace('MW', '')) * 0.8,
                    utilization: Math.random() * 95 + 5,
                    status: currentPrice > 80 ? 'high' : currentPrice > 40 ? 'normal' : 'low',
                    trend: Math.random() > 0.5 ? 'up' : 'down',
                    volatility: volatility * 100,
                    lastUpdate: new Date().toISOString()
                };
            });

            return zonesData;
        }

        function renderAllZones(zonesData) {
            // Render all zones
            renderZonesByType(zonesData, 'all', 'allZonesGrid');
            
            // Render by type
            renderZonesByType(zonesData, 'utility', 'utilitiesGrid');
            renderZonesByType(zonesData, 'hub', 'hubsGrid');
            renderZonesByType(zonesData, 'interface', 'interfacesGrid');
            renderZonesByType(zonesData, 'generation', 'generationGrid');
            renderZonesByType(zonesData, 'load', 'loadGrid');
        }

        function renderZonesByType(zonesData, type, containerId) {
            const container = document.getElementById(containerId);
            const filteredZones = type === 'all' ? zonesData : 
                Object.fromEntries(Object.entries(zonesData).filter(([_, zone]) => zone.type === type));

            const zoneCards = Object.entries(filteredZones).map(([zoneName, zone]) => `
                <div class="zone-card" onclick="showZoneDetails('${zoneName}')">
                    <div class="zone-header">
                        <div class="zone-name">${zoneName}</div>
                        <div class="zone-type">${zone.type}</div>
                    </div>
                    <div class="zone-price ${zone.status}">
                        ${zone.currentLMP.toFixed(2)}/MWh
                        <span style="font-size: 0.6em; margin-left: 8px;">
                            ${zone.trend === 'up' ? 'ðŸ“ˆ' : 'ðŸ“‰'}
                        </span>
                    </div>
                    <div class="zone-details">
                        <div class="detail-row">
                            <span>State:</span>
                            <span>${zone.state}</span>
                        </div>
                        <div class="detail-row">
                            <span>Capacity:</span>
                            <span>${zone.capacity}</span>
                        </div>
                        <div class="detail-row">
                            <span>Day-Ahead:</span>
                            <span>${zone.dayAheadLMP.toFixed(2)}</span>
                        </div>
                        <div class="detail-row">
                            <span>Congestion:</span>
                            <span>${zone.congestion.toFixed(2)}</span>
                        </div>
                        <div class="detail-row">
                            <span>Utilization:</span>
                            <span>${zone.utilization.toFixed(1)}%</span>
                        </div>
                        <div class="detail-row">
                            <span>Volatility:</span>
                            <span>${zone.volatility.toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = zoneCards;
        }

        async function initializeCharts() {
            initializeRealTimeChart();
            initializeLoadGenerationChart();
            initializePredictionsChart();
            initializeHistoricalCharts();
            initializeAdvancedCharts();
        }

        function initializeRealTimeChart() {
            const ctx = document.getElementById('realTimeChart').getContext('2d');
            
            // Generate 24 hours of data
            const hours = Array.from({length: 24}, (_, i) => {
                const date = new Date();
                date.setHours(date.getHours() - 23 + i);
                return date.getHours() + ':00';
            });

            const rtData = generateHourlyData(24, 45, 0.3);
            const daData = generateHourlyData(24, 45, 0.2);

            charts.realTime = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [
                        {
                            label: 'Real-Time LMP',
                            data: rtData,
                            borderColor: '#00d4ff',
                            backgroundColor: 'rgba(0, 212, 255, 0.1)',
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Day-Ahead LMP',
                            data: daData,
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: getChartOptions('Price ($/MWh)')
            });
        }

        function initializeLoadGenerationChart() {
            const ctx = document.getElementById('loadGenerationChart').getContext('2d');
            
            const hours = Array.from({length: 24}, (_, i) => {
                const date = new Date();
                date.setHours(date.getHours() - 23 + i);
                return date.getHours() + ':00';
            });

            const loadData = generateHourlyData(24, 85, 0.2);
            const genData = loadData.map(load => load + Math.random() * 10 + 5);

            charts.loadGeneration = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [
                        {
                            label: 'System Load',
                            data: loadData,
                            borderColor: '#ff9f43',
                            backgroundColor: 'rgba(255, 159, 67, 0.1)',
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Total Generation',
                            data: genData,
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: getChartOptions('Power (GW)')
            });
        }

        function initializePredictionsChart() {
            const ctx = document.getElementById('predictionsChart').getContext('2d');
            
            const hours = Array.from({length: 24}, (_, i) => {
                const date = new Date();
                date.setHours(date.getHours() + i);
                return date.getHours() + ':00';
            });

            // Generate predictions for major zones
            const majorZones = ['WESTERN_HUB', 'EASTERN_HUB', 'COMED', 'PSEG', 'PECO'];
            const datasets = majorZones.map((zone, index) => {
                const colors = ['#00d4ff', '#ff4757', '#00ff88', '#ff9f43', '#9c88ff'];
                return {
                    label: zone,
                    data: generateHourlyData(24, 45 + index * 10, 0.25),
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4,
                    fill: false
                };
            });

            charts.predictions = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: datasets
                },
                options: getChartOptions('Predicted LMP ($/MWh)')
            });
        }

        function initializeHistoricalCharts() {
            initializeHourlyChart();
            initializeMonthlyChart();
            initializeSeasonalChart();
            initializeVolatilityChart();
        }

        function initializeHourlyChart() {
            const ctx = document.getElementById('hourlyChart').getContext('2d');
            
            const hours = Array.from({length: 24}, (_, i) => i + ':00');
            const avgPrices = hours.map((_, i) => {
                // Peak hours (6 AM - 10 PM) are typically higher
                const peakMultiplier = (i >= 6 && i <= 22) ? 1.3 : 0.8;
                return 45 * peakMultiplier + Math.random() * 10;
            });

            charts.hourly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hours,
                    datasets: [{
                        label: '365-Day Hourly Average',
                        data: avgPrices,
                        backgroundColor: 'rgba(0, 212, 255, 0.6)',
                        borderColor: '#00d4ff',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: getChartOptions('Average LMP ($/MWh)')
            });
        }

        function initializeMonthlyChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyAvgs = months.map((_, i) => {
                // Summer (Jun-Aug) and Winter (Dec-Feb) typically higher
                const seasonalMultiplier = (i >= 5 && i <= 7) || (i >= 11 || i <= 1) ? 1.4 : 1.0;
                return 45 * seasonalMultiplier + Math.random() * 15;
            });

            charts.monthly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Monthly Average LMP',
                        data: monthlyAvgs,
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#00ff88',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: getChartOptions('Average LMP ($/MWh)')
            });
        }

        function initializeSeasonalChart() {
            const ctx = document.getElementById('seasonalChart').getContext('2d');
            
            const seasons = ['Spring', 'Summer', 'Fall', 'Winter'];
            const seasonalData = [42, 68, 38, 55]; // Typical seasonal patterns

            charts.seasonal = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: seasons,
                    datasets: [{
                        data: seasonalData,
                        backgroundColor: [
                            '#00ff88',
                            '#ff4757',
                            '#ff9f43',
                            '#00d4ff'
                        ],
                        borderColor: '#0a0f1c',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#e0e6ed' }
                        }
                    }
                }
            });
        }

        function initializeVolatilityChart() {
            const ctx = document.getElementById('volatilityChart').getContext('2d');
            
            const zones = ['WESTERN_HUB', 'EASTERN_HUB', 'COMED', 'PSEG', 'PECO', 'BGE', 'DOM', 'AEP'];
            const volatilityData = zones.map(() => Math.random() * 25 + 5);

            charts.volatility = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: zones,
                    datasets: [{
                        label: 'Price Volatility (%)',
                        data: volatilityData,
                        backgroundColor: volatilityData.map(v => 
                            v > 20 ? '#ff4757' : v > 15 ? '#ff9f43' : '#00ff88'
                        ),
                        borderColor: '#0a0f1c',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: getChartOptions('Volatility (%)')
            });
        }

        function initializeAdvancedCharts() {
            initializeCorrelationChart();
            initializeCongestionChart();
            initializeGenerationMixChart();
        }

        function initializeCorrelationChart() {
            const ctx = document.getElementById('correlationChart').getContext('2d');
            
            // Simplified correlation heatmap
            const zones = ['WESTERN', 'EASTERN', 'COMED', 'PSEG'];
            const correlationData = [];
            
            zones.forEach((zone1, i) => {
                zones.forEach((zone2, j) => {
                    correlationData.push({
                        x: i,
                        y: j,
                        v: i === j ? 1 : 0.3 + Math.random() * 0.6
                    });
                });
            });

            charts.correlation = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Price Correlation',
                        data: correlationData.map(d => ({
                            x: d.x,
                            y: d.y,
                            backgroundColor: `rgba(0, 212, 255, ${d.v})`
                        })),
                        backgroundColor: correlationData.map(d => `rgba(0, 212, 255, ${d.v})`),
                        pointRadius: <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PJM Advanced Energy Analytics Dashboard - Complete Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0f1c 0%, #1a1f2e 100%);
            color: #e0e6ed;
            overflow-x: hidden;
        }

        .dashboard {
            padding: 20px;
            max-width: 2400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #4a90e2 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 20s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.3; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.7; }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #0099ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .header-stats {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(0,255,136,0.2);
            border-radius: 25px;
            font-size: 0.95em;
            border: 2px solid rgba(0,255,136,0.3);
            backdrop-filter: blur(10px);
        }

        .live-dot {
            width: 12px;
            height: 12px;
            background: #00ff88;
            border-radius: 50%;
            animation: blink 2s infinite;
            box-shadow: 0 0 10px #00ff88;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.8); }
        }

        .alert-counter {
            background: linear-gradient(135deg, #ff4757 0%, #ff6b7a 100%);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,71,87,0.3);
        }

        .alert-counter:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255,71,87,0.4);
        }

        .notifications-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: linear-gradient(135deg, #1a2332 0%, #2d3748 100%);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            z-index: 1000;
            overflow: hidden;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notifications-panel.show {
            transform: translateX(0);
        }

        .notifications-header {
            padding: 20px;
            background: linear-gradient(135deg, #0099ff 0%, #00d4ff 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notifications-body {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .notification-item {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .notification-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .notification-item.critical {
            border-left-color: #ff4757;
            background: rgba(255,71,87,0.1);
        }

        .notification-item.warning {
            border-left-color: #ff9f43;
            background: rgba(255,159,67,0.1);
        }

        .notification-item.info {
            border-left-color: #00d4ff;
            background: rgba(0,212,255,0.1);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #1a2332 0%, #2d3748 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #00d4ff, #0099ff, #00ff88, #00d4ff);
            background-size: 300% 100%;
            animation: gradient-flow 3s ease infinite;
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .metric-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            border-color: rgba(0,212,255,0.3);
        }

        .metric-card.alert {
            background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
            animation: alert-pulse 2s infinite;
        }

        @keyframes alert-pulse {
            0%, 100% { box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 8px 25px rgba(255,71,87,0.5); }
        }

        .metric-label {
            font-size: 0.9em;
            color: #8892b0;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 600;
        }

        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,212,255,0.3);
        }

        .metric-change {
            font-size: 0.9em;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .metric-change.positive {
            color: #00ff88;
            background: rgba(0,255,136,0.2);
        }

        .metric-change.negative {
            color: #ff4757;
            background: rgba(255,71,87,0.2);
        }

        .chart-container {
            background: linear-gradient(135deg, #1a2332 0%, #2d3748 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(0,212,255,0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .chart-title {
            font-size: 1.6em;
            font-weight: 700;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .chart-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #0099ff 0%, #00d4ff 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9em;
            border: 2px solid transparent;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,153,255,0.4);
        }

        .btn.active {
            background: linear-gradient(135deg, #00ff88 0%, #00d4ff 100%);
            box-shadow: 0 5px 15px rgba(0,255,136,0.3);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #8892b0 0%, #a0a8b8 100%);
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            font-weight: 600;
        }

        .tab.active {
            background: linear-gradient(135deg, #0099ff 0%, #00d4ff 100%);
            color: white;
            box-shadow: 0 -5px 15px rgba(0,153,255,0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .zones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .zone-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .zone-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            transition: width 0.3s ease;
        }

        .zone-card:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-5px);
            border-color: #00d4ff;
            box-shadow: 0 10px 25px rgba(0,212,255,0.2);
        }

        .zone-card:hover::before {
            width: 100%;
            opacity: 0.1;
        }

        .zone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .zone-name {
            font-weight: bold;
            color: #00d4ff;
            font-size: 1.2em;
        }

        .zone-type {
            font-size: 0.8em;
            padding: 4px 10px;
            border-radius: 15px;
            background: rgba(0,212,255,0.2);
            color: #00d4ff;
            border: 1px solid rgba(0,212,255,0.3);
        }

        .zone-price {
            font-size: 1.6em;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .zone-price.high { 
            color: #ff4757; 
            text-shadow: 0 2px 4px rgba(255,71,87,0.3);
        }
        .zone-price.normal { 
            color: #00ff88; 
            text-shadow: 0 2px 4px rgba(0,255,136,0.3);
        }
        .zone-price.low { 
            color: #ffb142; 
            text-shadow: 0 2px 4px rgba(255,177,66,0.3);
        }

        .zone-details {
            font-size: 0.9em;
            color: #8892b0;
            line-height: 1.5;
        }

        .zone-details .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .historical-analytics {
            background: linear-gradient(135deg, #1a2332 0%, #2d3748 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .analytics-card {
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .analytics-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .prediction-container {
            background: linear-gradient(135deg, #1a2332 0%, #2d3748 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .prediction-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .prediction-card:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
        }

        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(255,71,87,0.2);
            border: 1px solid rgba(255,71,87,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #ff4757;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .zones-grid {
                grid-template-columns: 1fr;
            }

            .notifications-panel {
                width: 90%;
                right: 5%;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a2332 0%, #2d3748 100%);
            margin: 3% auto;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 1000px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 32px;
            cursor: pointer;
            color: #8892b0;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: #ff4757;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <header class="header">
            <div class="header-content">
                <div>
                    <h1>âš¡ PJM Advanced Energy Analytics</h1>
                    <p>Real-time Market Intelligence â€¢ 365-Day Analytics â€¢ AI Predictions â€¢ All Zones Coverage</p>
                </div>
                <div class="header-stats">
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>LIVE DATA</span>
                    </div>
                    <div class="alert-counter" onclick="toggleNotifications()">
                        ðŸš¨ <span id="alertCount">0</span> Alerts
                    </div>
                    <div style="color: #8892b0; font-size: 0.9em;">
                        <div id="currentTime">Loading...</div>
                        <div>EST</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Real-time Notifications Panel -->
        <div class="notifications-panel" id="notificationsPanel">
            <div class="notifications-header">
                <h3>ðŸ”” Live Alerts & Notifications</h3>
                <span onclick="toggleNotifications()" style="cursor: pointer; font-size: 1.2em;">âœ•</span>
            </div>
            <div class="notifications-body" id="notificationsBody">
                <div class="loading-spinner"></div>
                <span style="margin-left: 10px;">Loading alerts...</span>
            </div>
        </div>

        <!-- Enhanced Metrics Grid -->
        <div class="metrics-grid" id="metricsGrid">
            <!-- Metrics will be populated here -->
        </div>

        <!-- 365-Day Historical Analytics -->
        <div class="historical-analytics">
            <h2 class="chart-title">ðŸ“Š 365-Day Historical Analytics Dashboard</h2>
            <div class="tabs">
                <div class="tab active" onclick="switchAnalyticsTab('hourly', this)">Hourly Averages</div>
                <div class="tab" onclick="switchAnalyticsTab('monthly', this)">Monthly Trends</div>
                <div class="tab" onclick="switchAnalyticsTab('seasonal', this)">Seasonal Analysis</div>
                <div class="tab" onclick="switchAnalyticsTab('volatility', this)">Volatility Analysis</div>
            </div>
            
            <div id="hourly" class="tab-content active">
                <canvas id="hourlyChart" width="400" height="200"></canvas>
            </div>
            
            <div id="monthly" class="tab-content">
                <canvas id="monthlyChart" width="400" height="200"></canvas>
            </div>
            
            <div id="seasonal" class="tab-content">
                <canvas id="seasonalChart" width="400" height="200"></canvas>
            </div>
            
            <div id="volatility" class="tab-content">
                <canvas id="volatilityChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Real-time Market Overview -->
        <div class="grid-2">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">ðŸ“ˆ Real-time vs Day-Ahead LMP</h2>
                    <div class="chart-controls">
                        <button class="btn active" onclick="updateTimeRange('1h', this)">1H</button>
                        <button class="btn" onclick="updateTimeRange('6h', this)">6H</button>
                        <button class="btn" onclick="updateTimeRange('24h', this)">24H</button>
                        <button class="btn" onclick="updateTimeRange('7d', this)">7D</button>
                    </div>
                </div>
                <canvas id="realTimeChart" width="400" height="200"></canvas>
            </div>

            <div class="chart-container">
                <h2 class="chart-title">ðŸŽ¯ System Load & Generation</h2>
                <canvas id="loadGenerationChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- All Zones Coverage -->
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">ðŸ¢ All PJM Zones - Real-time Status</h2>
                <div class="tabs">
                    <div class="tab active" onclick="switchZoneTab('all', this)">All Zones (48)</div>
                    <div class="tab" onclick="switchZoneTab('utilities', this)">Utilities (20)</div>
                    <div class="tab" onclick="switchZoneTab('hubs', this)">Trading Hubs (5)</div>
                    <div class="tab" onclick="switchZoneTab('interfaces', this)">Interfaces (12)</div>
                    <div class="tab" onclick="switchZoneTab('generation', this)">Generation (6)</div>
                    <div class="tab" onclick="switchZoneTab('load', this)">Load Zones (8)</div>
                </div>
            </div>
            
            <div id="all" class="tab-content active">
                <div class="zones-grid" id="allZonesGrid">
                    <!-- All zones will be populated here -->
                </div>
            </div>
            
            <div id="utilities" class="tab-content">
                <div class="zones-grid" id="utilitiesGrid"></div>
            </div>
            
            <div id="hubs" class="tab-content">
                <div class="zones-grid" id="hubsGrid"></div>
            </div>
            
            <div id="interfaces" class="tab-content">
                <div class="zones-grid" id="interfacesGrid"></div>
            </div>
            
            <div id="generation" class="tab-content">
                <div class="zones-grid" id="generationGrid"></div>
            </div>
            
            <div id="load" class="tab-content">
                <div class="zones-grid" id="loadGrid"></div>
            </div>
        </div>

        <!-- AI Predictions for All Zones -->
        <div class="prediction-container">
            <h2 class="chart-title">ðŸ”® AI Predictions - All Zones (Next 24 Hours)</h2>
            <div class="chart-controls">
                <button class="btn active" onclick="updatePredictionRange('6h', this)">6H</button>
                <button class="btn" onclick="updatePredictionRange('12h', this)">12H</button>
                <button class="btn" onclick="updatePredictionRange('24h', this)">24H</button>
                <button class="btn" onclick="updatePredictionRange('48h', this)">48H</button>
            </div>
            <canvas id="predictionsChart" width="400" height="300"></canvas>
        </div>

        <!-- Advanced Analytics -->
        <div class="analytics-grid">
            <div class="analytics-card">
                <h3 class="analytics-title">ðŸŽ¯ Price Correlation Matrix</h3>
                <canvas id="correlationChart" width="300" height="200"></canvas>
            </div>
            
            <div class="analytics-card">
                <h3 class="analytics-title">ðŸ“Š Congestion Analysis</h3>
                <canvas id="congestionChart" width="300" height="200"></canvas>
            </div>
            
            <div class="analytics-card">
                <h3 class="analytics-title">âš¡ Generation Mix</h3>
                <canvas id="generationMixChart" width="300" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Zone Detail Modal -->
    <div id="zoneModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Global variables
        let charts = {};
        let currentData = {};
        let notificationsVisible = false;
        let updateInterval;

        // PJM Zones Data
        const pjmZones = {
            // Major Utility Zones
            'AECO': { type: 'utility', state: 'NJ', capacity: '2400MW', full_name: 'Atlantic Electric Company' },
            'AEP': { type: 'utility', state: 'OH/WV/VA', capacity: '22000MW', full_name: 'American Electric Power' },
            'AP': { type: 'utility', state: 'PA', capacity: '9500MW', full_name: 'Allegheny Power' },
            'ATSI': { type: 'utility', state: 'OH', capacity: '12500MW', full_name: 'American Transmission Systems' },
            'BGE': { type: 'utility', state: 'MD', capacity: '5800MW', full_name: 'Baltimore Gas & Electric' },
            'COMED': { type: 'utility', state: 'IL', capacity: '23000MW', full_name: 'Commonwealth Edison' },
